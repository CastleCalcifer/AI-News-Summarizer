version: '3'
services:
  collector:
    build:
      context: .
      dockerfile: collector/Dockerfile
    ports:
      - "5001:5000"
    environment:
      - SUMMARIZER_URL=http://summarizer:5000
      - NEWS_API_KEY=${NEWS_API_KEY}
      - ENABLE_GET_TEST_ROUTES=${ENABLE_GET_TEST_ROUTES}
    networks:
      - news-network
    depends_on:
      - summarizer
    
  summarizer:
    build:
      context: .
      dockerfile: summarizer/Dockerfile
    ports:
      - "5002:5000"
    environment:
      - SENTIMENT_URL=http://sentiment:5000
      - ENABLE_GET_TEST_ROUTES=${ENABLE_GET_TEST_ROUTES}
      # When the local LLM runs on the host at port 11434, containers should use host.docker.internal
  - LOCAL_LLM_API_URL=http://host.docker.internal:11434/api/generate
    networks:
      - news-network
    depends_on:
      - sentiment
    
  sentiment:
    build:
      context: .
      dockerfile: sentiment/Dockerfile
    ports:
      - "5003:5000"
    networks:
      - news-network

networks:
  news-network:
    driver: bridge